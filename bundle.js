interact(".resize").resizable({edges:{top:true,left:true,bottom:true,right:true},listeners:{move:function(event){let{x,y}=event.target.dataset;x=(parseFloat(x)||0)+event.deltaRect.left;y=(parseFloat(y)||0)+event.deltaRect.top;Object.assign(event.target.style,{width:`${event.rect.width}px`,height:`${event.rect.height}px`,transform:`translate(${x}px, ${y}px)`});Object.assign(event.target.dataset,{x:x,y:y})}},modifiers:[interact.modifiers.restrictEdges({outer:"main"}),interact.modifiers.restrictSize({min:{width:100,height:50}})],inertia:true});interact(".draggable-header").draggable({inertia:true,modifiers:[interact.modifiers.restrictRect({restriction:"main",endOnly:true})],autoScroll:true,listeners:{move:dragMoveListener}});function dragMoveListener(event){var target=event.target.parentElement;var x=(parseFloat(target.getAttribute("data-x"))||0)+event.dx;var y=(parseFloat(target.getAttribute("data-y"))||0)+event.dy;target.style.transform="translate("+x+"px, "+y+"px)";target.setAttribute("data-x",x);target.setAttribute("data-y",y)}function NoteStore(){this.getStoredNotes=function(){var notes;if(localStorage.getItem("notes")===null){notes=[]}else{notes=JSON.parse(localStorage.getItem("notes"))}return notes};this.addNote=function(note){var notes=this.getStoredNotes();notes.push(note);localStorage.setItem("notes",JSON.stringify(notes))};this.saveNote=function(noteToSave){var notes=this.getStoredNotes();var noteIndex=notes.findIndex(note=>noteToSave.id===note.id);notes[noteIndex]=noteToSave;localStorage.setItem("notes",JSON.stringify(notes))};this.removeNote=function(id){var notes=this.getStoredNotes();notes.forEach((note,index)=>{if(note.id===id){notes.splice(index,1)}});localStorage.setItem("notes",JSON.stringify(notes))};return this}var noteStore=new NoteStore;function TabStore(){this.getStoredTabs=function(){var tabs;if(localStorage.getItem("tabs")===null){tabs=[]}else{tabs=JSON.parse(localStorage.getItem("tabs"))}return tabs};this.addTab=function(tab){var tabs=this.getStoredTabs();tabs.push(tab);localStorage.setItem("tabs",JSON.stringify(tabs))};this.saveTab=function(tabToSave){var tabs=this.getStoredTabs();var tabIndex=tabs.findIndex(tab=>tabToSave.id===tab.id);tabs[tabIndex]=tabToSave;localStorage.setItem("tabs",JSON.stringify(tabs))};this.removeTab=function(id){var tabs=this.getStoredTabs();tabs.forEach((tab,index)=>{if(tab.id===id){tabs.splice(index,1)}});localStorage.setItem("tabs",JSON.stringify(tabs))};return this}var tabStore=new TabStore;var currentTab="";function Tab(props){var self=this;this.id=props.id;this.title=props.title;if(!window.tabs)window.tabs={};window.tabs[this.id]=this;this.render=function(){var tabContainerElem=document.getElementById("tab-container");var tabDiv=document.createElement("div");tabDiv.classList.add("tab");tabDiv.id=this.id;tabDiv.addEventListener("mouseup",function(event){if(event.target.tagName==="BUTTON")return;highlightTab(self.id,false)});var tabInput=document.createElement("input");tabInput.placeholder="New Tab";tabInput.value=this.title;tabInput.addEventListener("focusout",function(){self.title=tabInput.value;self.saveTab()});var tabRemoveButton=document.createElement("button");tabRemoveButton.innerText="✕";tabRemoveButton.addEventListener("mouseup",function(){var allTabs=Object.values(window.tabs);if(allTabs.length>1){if(window.confirm(`Are you sure you want to delete tab: "${self.title}"`)){var previousTab=tabDiv.previousElementSibling;var nextTab=tabDiv.nextElementSibling;if(previousTab)highlightTab(previousTab.id,false);else if(newTab)highlightTab(nextTab.id,false);var allNotes=Object.values(window.notes);allNotes.forEach(note=>{if(note.tab===self.id){noteStore.removeNote(note.id)}});delete window.tabs[tabDiv.id];tabDiv.remove();tabStore.removeTab(self.id)}}});tabDiv.appendChild(tabInput);tabDiv.appendChild(tabRemoveButton);tabContainerElem.insertBefore(tabDiv,document.getElementById("new-tab-btn"))};this.saveTab=function(){var tabs=tabStore.getStoredTabs();var isAlreadyTab=tabs.some(tab=>tab.id===self.id);if(!isAlreadyTab)tabStore.addTab(self);else tabStore.saveTab(self)};this.render();return this}function newTab(focus){var newTab=new Tab({id:uuid.v4(),title:""});newTab.saveTab();highlightTab(newTab.id,focus)}function getSavedTabs(){var tabs=tabStore.getStoredTabs();if(tabs.length===0){newTab(false)}else{tabs.forEach(tab=>{new Tab({id:tab.id,title:tab.title})});highlightTab(tabs[0].id,false)}}function highlightTab(tabToHighlightId,focus){currentTab=tabToHighlightId;var allTabs=Object.values(window.tabs);allTabs.forEach(tab=>{var tabElem=document.getElementById(tab.id);if(tab.id===tabToHighlightId){tabElem.setAttribute("style","border-bottom: 0px");if(focus)tabElem.children[0].focus()}else tabElem.setAttribute("style","border-bottom: 1px solid var(--second-gray)")});setTimeout(()=>{var allNotes=Object.values(window.notes);allNotes.forEach(note=>{if(note.tab===currentTab)document.getElementById(note.id).style.visibility="visible";else document.getElementById(note.id).style.visibility="hidden"})},10)}getSavedTabs();window.getNote=function(elem){var id=elem.closest("section").id;return window.notes[id]};function Note(props){this.id=props.id;this.color=props.color;this.title=props.title?props.title:"";this.text=props.text?props.text:"";this.top=props.top;this.left=props.left;this.width=props.width;this.height=props.height;this.zIndex=props.zIndex;this.tab=props.tab;if(!window.notes)window.notes={};window.notes[this.id]=this;this.render=function(){var section=document.createElement("section");this.section=section;section.id=this.id;section.style.top=`${this.top}px`;section.style.left=`${this.left}px`;section.style.width=`${this.width}px`;section.style.height=`${this.height}px`;section.style.zIndex=this.zIndex;section.classList.add("resize");section.addEventListener("mousedown",function(e){e.stopPropagation();var notesArray=Object.values(window.notes);notesArray.forEach(function(note){var noteElem=document.getElementById(note.id);if(section.id===noteElem.id){section.style.zIndex=2;note.zIndex=2;note.saveNote()}else{noteElem.style.zIndex=1;note.zIndex=1;note.saveNote()}})},true);var sectionBody=`
      <div class="draggable-header">
        <input onfocusout="var self = window.getNote(this); self.title = this.value; self.saveNote()" onmouseup="var self = window.getNote(this); self.title = this.value; self.saveNote()" id="title" placeholder="New Note" value="${this.title}">
        <button tabindex="-1" onclick="var self = window.getNote(this); self.removeNote(self, this.parentElement.parentElement)">✕</button>
      </div>
      <textarea onfocusout="var self = window.getNote(this); self.text = this.value; self.saveNote()" id="text" placeholder="Start Typing...">${this.text}</textarea>
    `;section.innerHTML=sectionBody;section.children[0].style.backgroundColor=this.color;document.querySelector("main").appendChild(section);var resizeObserver=new ResizeObserver(throttle(entries=>{if(window.notes[this.section.id])this.saveNote()},100));resizeObserver.observe(this.section)};this.saveNote=function(){var newNote=props;newNote.title=this.title;newNote.text=this.text;newNote.color=this.color;newNote.tab=this.tab;var elemRect=this.section.getBoundingClientRect();var mainRect=document.querySelector("main").getBoundingClientRect();var relativeTop=elemRect.top-mainRect.top;newNote.top=relativeTop;this.top=relativeTop;newNote.left=elemRect.left;this.left=elemRect.left;newNote.zIndex=this.zIndex;newNote.width=this.section.offsetWidth;this.width=this.section.offsetWidth;newNote.height=this.section.offsetHeight;this.height=this.section.offsetHeight;var notes=noteStore.getStoredNotes();var isAlreadyNote=notes.some(note=>note.id===newNote.id);if(!isAlreadyNote)noteStore.addNote(newNote);else noteStore.saveNote(newNote);window.notes[newNote.id]=this};this.removeNote=function(self,noteSection){if(window.confirm(`Are you sure you want to delete note: "${this.title}"`)){noteStore.removeNote(noteSection.id);noteSection.remove();delete window.notes[self.id]}};this.render();return this}function newNote(){function getNewSpot(top,left){var isInSpot=Object.values(window.notes).some(note=>note.top===top&&note.left===left);if(isInSpot){top+=16;left+=16;getNewSpot(top,left)}else{var newNote=new Note({id:uuid.v4(),tab:currentTab,color:getRandomColor(),top:top,left:left});var notesArray=Object.values(window.notes);notesArray.forEach(function(note){var noteElem=document.getElementById(note.id);if(newNote.id===noteElem.id){noteElem.style.zIndex=2;note.zIndex=2;note.saveNote()}else{noteElem.style.zIndex=1;note.zIndex=1;note.saveNote()}});var newNoteElem=document.getElementById(newNote.id);newNoteElem.children[0].children[0].focus()}}var startTop=8;var startLeft=8;getNewSpot(startTop,startLeft)}function getSavedNotes(){var notes=noteStore.getStoredNotes();if(notes.length===0){var newNote1=new Note({id:uuid.v4(),tab:currentTab,color:"#0083C9",top:8,left:8});newNote1.saveNote()}else{notes.forEach(note=>{new Note({id:note.id,tab:note.tab?note.tab:currentTab,color:note.color,title:note.title,text:note.text,top:note.top,left:note.left,width:note.width,height:note.height,zIndex:note.zIndex})})}}function getRandomColor(){var letters="0123456789ABCDEF";var color="#";for(var i=0;i<6;i++){color+=letters[Math.floor(Math.random()*16)]}return color}function throttle(f,delay){let timer=0;return function(...args){clearTimeout(timer);timer=setTimeout(()=>f.apply(this,args),delay)}}getSavedNotes();